<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Custom YouTube Player</title>

<style>
:root{
  --bg:#000;
  --panel:rgba(0,0,0,.65);
  --accent:#ff7a18;
  --accent-soft:rgba(255,122,24,.25);
  --text:#fff;
  --muted:#bdbdbd;
  --radius:14px;
}

*{box-sizing:border-box}

body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  display:flex;
  align-items:center;
  justify-content:center;
  min-height:100vh;
  padding:16px;
  background: linear-gradient(135deg, #1a1a1a 0%, #0a0a0a 100%);
}

.wrap{
  position:relative;
  width:min(1100px,100%);
  aspect-ratio:16/9;
  background:#000;
  border-radius:var(--radius);
  overflow:hidden;
  box-shadow:0 20px 60px rgba(0,0,0,.6);
}

#player{
  width:100%;
  height:100%;
  background:#000;
}

/* BLOCKERS */
#headerBlocker{
  position:absolute;
  top:0;left:0;right:0;
  height:70px;
  z-index:6;
  background: linear-gradient(to bottom, rgba(0,0,0,0.8) 0%, transparent 100%);
  pointer-events: none;
}

#videoBlocker{
  position:absolute;
  inset:0;
  z-index:3;
  cursor: pointer;
}

/* OVERLAY */
#overlay{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  background:linear-gradient(
    to bottom,
    rgba(0,0,0,.45),
    rgba(0,0,0,.25)
  );
  z-index:5;
  transition: opacity 0.3s ease;
}

#overlay.fade-out {
  opacity: 0;
  pointer-events: none;
}

#bigPlay{
  width:92px;height:92px;
  border-radius:50%;
  border:0;
  cursor:pointer;
  background:radial-gradient(circle at 30% 30%, #ff9a3d, var(--accent));
  color:#000;
  font-size:36px;
  display:grid;
  place-items:center;
  box-shadow:
    0 0 0 6px rgba(255,122,24,.15),
    0 12px 30px rgba(0,0,0,.6);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

#bigPlay:hover {
  transform: scale(1.05);
  box-shadow:
    0 0 0 10px rgba(255,122,24,.2),
    0 15px 40px rgba(0,0,0,.7);
}

/* LOADER */
#loader{
  position:absolute;
  inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  background:rgba(0,0,0,.45);
  z-index:7;
}

.spinner{
  width:48px;
  height:48px;
  border:4px solid rgba(255,255,255,.25);
  border-top-color:var(--accent);
  border-radius:50%;
  animation:spin 1s linear infinite;
}

@keyframes spin{
  to{transform:rotate(360deg)}
}

/* CONTROLS */
#controls{
  position:absolute;
  left:0;right:0;bottom:0;
  z-index:8;
  padding:12px 14px 16px;
  display:flex;
  gap:12px;
  align-items:center;
  background:linear-gradient(
    to top,
    rgba(0,0,0,.9),
    transparent
  );
  opacity: 1;
  transition: opacity 0.3s ease, transform 0.3s ease;
}

#controls.hidden {
  opacity: 0;
  transform: translateY(10px);
  pointer-events: none;
}

.btn{
  background:var(--panel);
  border:0;
  color:#fff;
  font-size:18px;
  cursor:pointer;
  padding:8px 12px;
  border-radius:10px;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  min-width: 40px;
}
.btn:hover{
  background:var(--accent-soft);
  transform: translateY(-1px);
}
.btn:active{
  transform: translateY(0);
}

/* TIMER */
#timer{
  font-size:12px;
  color:var(--muted);
  min-width:96px;
  text-align:center;
  background:var(--panel);
  padding:8px 10px;
  border-radius:10px;
  font-variant-numeric: tabular-nums;
  font-weight: 500;
  letter-spacing: 0.5px;
}

/* PROGRESS */
.progress-container {
  position: relative;
  flex: 1;
  height: 4px;
  background: rgba(255,255,255,.25);
  border-radius: 999px;
  cursor: pointer;
  transition: height 0.2s ease;
}

.progress-container:hover {
  height: 6px;
}

.progress-fill {
  position: absolute;
  height: 100%;
  background: var(--accent);
  border-radius: 999px;
  width: 0%;
  pointer-events: none;
  transition: height 0.2s ease;
}

.progress-handle {
  position: absolute;
  width: 14px;
  height: 14px;
  background: var(--accent);
  border-radius: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  pointer-events: none;
  opacity: 0;
  transition: opacity 0.2s ease, transform 0.2s ease;
  box-shadow: 0 0 0 4px rgba(255,122,24,.25);
}

.progress-container:hover .progress-handle {
  opacity: 1;
  transform: translate(-50%, -50%) scale(1.2);
}

/* VOLUME CONTROL - Vertical popup */
.volume-container {
  position: relative;
}

.volume-popup {
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  margin-bottom: 10px;
  background: var(--panel);
  padding: 12px 8px;
  border-radius: 10px;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
  box-shadow: 0 10px 30px rgba(0,0,0,.4);
}

.volume-popup.show {
  opacity: 1;
  visibility: visible;
}

.volume-slider {
  width: 4px;
  height: 100px;
  appearance: none;
  background: rgba(255,255,255,.25);
  border-radius: 999px;
  cursor: pointer;
  writing-mode: bt-lr;
  -webkit-appearance: slider-vertical;
  margin: 0 auto;
}

.volume-slider::-webkit-slider-thumb {
  appearance: none;
  width: 16px;
  height: 16px;
  border-radius: 50%;
  background: var(--accent);
  cursor: pointer;
}

.volume-fill {
  position: absolute;
  width: 4px;
  background: var(--accent);
  border-radius: 999px;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  pointer-events: none;
}

.volume-value {
  position: absolute;
  top: -25px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 11px;
  color: var(--muted);
  background: var(--panel);
  padding: 2px 6px;
  border-radius: 4px;
  white-space: nowrap;
}

/* FULLSCREEN BUTTON */
#fullscreenBtn {
  background: var(--panel);
  border: 0;
  color: #fff;
  font-size: 20px;
  cursor: pointer;
  padding: 8px 12px;
  border-radius: 10px;
  transition: all 0.2s ease;
}

#fullscreenBtn:hover {
  background: var(--accent-soft);
  transform: translateY(-1px);
}

/* END SCREEN - Custom overlay instead of YouTube's related videos */
#endScreen {
  position: absolute;
  inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
  background: linear-gradient(to bottom, rgba(0,0,0,0.8), rgba(0,0,0,0.9));
  z-index: 4;
  text-align: center;
  padding: 20px;
}

.end-content {
  background: var(--panel);
  padding: 32px;
  border-radius: var(--radius);
  max-width: 400px;
  border: 1px solid rgba(255,122,24,0.2);
}

.end-content h3 {
  margin: 0 0 16px 0;
  color: var(--text);
  font-size: 24px;
}

.end-buttons {
  display: flex;
  gap: 12px;
  justify-content: center;
  margin-top: 24px;
}

.end-btn {
  background: var(--accent);
  color: #000;
  border: none;
  padding: 12px 24px;
  border-radius: 10px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
}

.end-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(255,122,24,0.3);
}

.end-btn.secondary {
  background: rgba(255,255,255,0.1);
  color: var(--text);
}

/* RESPONSIVE */
@media (max-width: 768px) {
  #bigPlay {
    width: 72px;
    height: 72px;
    font-size: 28px;
  }
  
  #controls {
    padding: 10px 12px 14px;
    gap: 8px;
  }
  
  .btn {
    padding: 6px 10px;
    font-size: 16px;
    min-width: 36px;
  }
  
  #timer {
    min-width: 80px;
    font-size: 11px;
  }
  
  .volume-slider {
    height: 80px;
  }
}
</style>
</head>

<body>
<div class="wrap">
  <div id="player"></div>
  
  <div id="headerBlocker"></div>
  <div id="videoBlocker"></div>
  
  <!-- Custom overlay for when video ends -->
  <div id="endScreen">
    <div class="end-content">
      <h3>Video Ended</h3>
      <p>Watch again or try another video</p>
      <div class="end-buttons">
        <button id="replayBtn" class="end-btn">â†» Replay</button>
        <button id="nextBtn" class="end-btn secondary">Next Video</button>
      </div>
    </div>
  </div>
  
  <div id="overlay">
    <button id="bigPlay">â–¶</button>
  </div>
  
  <div id="loader">
    <div class="spinner"></div>
  </div>
  
  <div id="controls">
    <button id="playPause" class="btn">â–¶</button>
    
    <div id="timer">0:00 / 0:00</div>
    
    <div class="progress-container">
      <div class="progress-fill"></div>
      <div class="progress-handle"></div>
    </div>
    
    <div class="volume-container">
      <button id="mute" class="btn">ðŸ”Š</button>
      <div class="volume-popup">
        <div class="volume-value">100%</div>
        <div class="volume-fill"></div>
        <input id="volume" type="range" min="0" max="100" value="100" class="volume-slider">
      </div>
    </div>
    
    <button id="fullscreenBtn" class="btn">â›¶</button>
  </div>
</div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
function formatTime(seconds){
  seconds = Math.floor(seconds || 0);
  const hours = Math.floor(seconds / 3600);
  const minutes = Math.floor((seconds % 3600) / 60);
  const secs = seconds % 60;
  
  if (hours > 0) {
    return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
  }
  return `${minutes}:${secs.toString().padStart(2, '0')}`;
}

function getVideoId(){
  const u = new URL(location.href);
  const videoId = u.searchParams.get('v') || u.hash.replace('#', '') || 'dQw4w9WgXcQ';
  return videoId.length === 11 ? videoId : 'dQw4w9WgXcQ';
}

let player, duration = 0, isPlaying = false, timer = null, seeking = false;
let playerReady = false, isMuted = false;
let mouseMoveTimer, volumePopupTimer;
let showVolumePopup = false;

const overlay = document.getElementById('overlay');
const bigPlay = document.getElementById('bigPlay');
const playPause = document.getElementById('playPause');
const timerEl = document.getElementById('timer');
const progressContainer = document.querySelector('.progress-container');
const progressFill = document.querySelector('.progress-fill');
const progressHandle = document.querySelector('.progress-handle');
const loader = document.getElementById('loader');
const volumeSlider = document.getElementById('volume');
const volumeFill = document.querySelector('.volume-fill');
const volumeValue = document.querySelector('.volume-value');
const volumePopup = document.querySelector('.volume-popup');
const muteBtn = document.getElementById('mute');
const fullscreenBtn = document.getElementById('fullscreenBtn');
const videoBlocker = document.getElementById('videoBlocker');
const controls = document.getElementById('controls');
const endScreen = document.getElementById('endScreen');
const replayBtn = document.getElementById('replayBtn');
const nextBtn = document.getElementById('nextBtn');

const VIDEO_ID = getVideoId();

// Important: YouTube Player Parameters to prevent related videos
const PLAYER_PARAMS = {
  controls: 0,           // Hide YouTube's native controls
  modestbranding: 1,     // Remove YouTube logo
  rel: 0,               // CRITICAL: Don't show related videos at end
  fs: 1,                // Allow fullscreen
  playsinline: 1,       // Play inline on iOS
  iv_load_policy: 3,    // Hide annotations
  disablekb: 0,         // IMPORTANT: Allow keyboard controls (was 1)
  autoplay: 0,          // Don't autoplay
  widget_referrer: 'https://custom-player.example.com',
  origin: window.location.origin
};

// Show/hide controls with mouse movement
videoBlocker.addEventListener('mousemove', () => {
  controls.classList.remove('hidden');
  overlay.classList.remove('fade-out');
  clearTimeout(mouseMoveTimer);
  mouseMoveTimer = setTimeout(() => {
    if (isPlaying && !showVolumePopup) {
      controls.classList.add('hidden');
      overlay.classList.add('fade-out');
    }
  }, 3000);
});

// Progress bar interaction
progressContainer.addEventListener('click', (e) => {
  if (!playerReady || !duration) return;
  
  const rect = progressContainer.getBoundingClientRect();
  const percent = (e.clientX - rect.left) / rect.width;
  const time = percent * duration;
  
  player.seekTo(time, true);
  updateProgress(time / duration * 100);
});

progressContainer.addEventListener('mousemove', (e) => {
  if (!playerReady || !duration) return;
  
  const rect = progressContainer.getBoundingClientRect();
  const percent = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));
  const time = percent * duration;
  
  // Preview time on hover
  timerEl.textContent = `${formatTime(time)} / ${formatTime(duration)}`;
});

// Volume popup control
muteBtn.addEventListener('click', (e) => {
  e.stopPropagation();
  toggleMute();
});

muteBtn.addEventListener('mouseenter', () => {
  showVolumePopup = true;
  volumePopup.classList.add('show');
  clearTimeout(volumePopupTimer);
});

muteBtn.addEventListener('mouseleave', () => {
  volumePopupTimer = setTimeout(() => {
    showVolumePopup = false;
    volumePopup.classList.remove('show');
  }, 300);
});

volumePopup.addEventListener('mouseenter', () => {
  showVolumePopup = true;
  clearTimeout(volumePopupTimer);
});

volumePopup.addEventListener('mouseleave', () => {
  volumePopupTimer = setTimeout(() => {
    showVolumePopup = false;
    volumePopup.classList.remove('show');
  }, 300);
});

// Volume slider
volumeSlider.addEventListener('input', (e) => {
  const value = e.target.value;
  if (!player) return;
  
  player.setVolume(value);
  isMuted = value == 0;
  muteBtn.textContent = isMuted ? 'ðŸ”‡' : 'ðŸ”Š';
  updateVolumeFill(value);
  volumeValue.textContent = `${value}%`;
});

// Fullscreen functionality
fullscreenBtn.addEventListener('click', toggleFullscreen);
function toggleFullscreen() {
  const container = document.querySelector('.wrap');
  if (!document.fullscreenElement) {
    container.requestFullscreen().catch(err => {
      console.log(`Error attempting to enable fullscreen: ${err.message}`);
    });
  } else {
    document.exitFullscreen();
  }
}

// End screen buttons
replayBtn.addEventListener('click', () => {
  endScreen.style.display = 'none';
  player.seekTo(0);
  player.playVideo();
});

nextBtn.addEventListener('click', () => {
  // In a real app, you would load a new video
  // For now, just replay the current one
  endScreen.style.display = 'none';
  player.seekTo(0);
  player.playVideo();
});

// Update progress bar
function updateProgress(percent) {
  progressFill.style.width = `${percent}%`;
  progressHandle.style.left = `${percent}%`;
}

// Update volume fill
function updateVolumeFill(value) {
  volumeFill.style.height = `${value}%`;
}

function onYouTubeIframeAPIReady(){
  if(!VIDEO_ID) return;
  player = new YT.Player('player', {
    videoId: VIDEO_ID,
    playerVars: PLAYER_PARAMS,
    events: {
      onReady: onReady,
      onStateChange: onStateChange,
      onError: onPlayerError
    }
  });
}
window.onYouTubeIframeAPIReady = onYouTubeIframeAPIReady;

function onReady(){
  playerReady = true;
  duration = player.getDuration() || 0;
  loader.style.display = 'none';
  updateUI();
  
  // Set initial volume
  player.setVolume(100);
  updateVolumeFill(100);
  volumeValue.textContent = '100%';
}

function onPlayerError(event) {
  console.error("YouTube Player Error:", event.data);
  loader.style.display = 'none';
}

function onStateChange(e){
  if(e.data === YT.PlayerState.BUFFERING){
    loader.style.display = 'flex';
  }
  
  if(e.data === YT.PlayerState.PLAYING){
    loader.style.display = 'none';
    isPlaying = true;
    overlay.style.display = 'none';
    endScreen.style.display = 'none';
    playPause.textContent = 'â¸';
    startTick();
    
    // Auto-hide controls after 3 seconds
    setTimeout(() => {
      if (isPlaying && !showVolumePopup) {
        controls.classList.add('hidden');
        overlay.classList.add('fade-out');
      }
    }, 3000);
  }
  
  if(e.data === YT.PlayerState.PAUSED){
    isPlaying = false;
    playPause.textContent = 'â–¶';
    stopTick();
    controls.classList.remove('hidden');
    overlay.classList.remove('fade-out');
  }
  
  // IMPORTANT: Handle video end with our custom screen
  if(e.data === YT.PlayerState.ENDED){
    isPlaying = false;
    playPause.textContent = 'â†»';
    stopTick();
    
    // Hide YouTube's native end screen by stopping the video
    player.stopVideo();
    
    // Show our custom end screen
    setTimeout(() => {
      endScreen.style.display = 'flex';
    }, 500);
  }
}

function togglePlay(){
  if(!player || !playerReady) return;

  // If video ended, restart it
  if (player.getPlayerState() === YT.PlayerState.ENDED) {
    endScreen.style.display = 'none';
    player.seekTo(0);
    player.playVideo();
    return;
  }

  if(isPlaying){
    player.pauseVideo();
  } else {
    player.playVideo();
  }
}

function toggleMute(){
  if(!player) return;
  isMuted = !isMuted;
  player[isMuted ? 'mute' : 'unMute']();
  muteBtn.textContent = isMuted ? 'ðŸ”‡' : 'ðŸ”Š';
  
  if (isMuted) {
    volumeSlider.value = 0;
  } else {
    volumeSlider.value = 100;
  }
  updateVolumeFill(volumeSlider.value);
  volumeValue.textContent = `${volumeSlider.value}%`;
}

bigPlay.onclick = () => {
  if(!player || !playerReady) return;
  
  if (player.getPlayerState() === YT.PlayerState.ENDED) {
    endScreen.style.display = 'none';
    player.seekTo(0);
  }
  
  player.playVideo();
};

playPause.onclick = togglePlay;

function startTick(){
  stopTick();
  timer = setInterval(updateUI, 200);
}

function stopTick(){
  if(timer){
    clearInterval(timer);
    timer = null;
  }
}

function updateUI(){
  if(!player) return;
  const currentTime = player.getCurrentTime() || 0;
  const percent = (currentTime / duration) * 100 || 0;
  
  if(!seeking) {
    updateProgress(percent);
  }
  
  timerEl.textContent = `${formatTime(currentTime)} / ${formatTime(duration)}`;
}

// Initialize
updateVolumeFill(100);

// Prevent right-click on video
videoBlocker.addEventListener('contextmenu', e => e.preventDefault());

// Click on video to play/pause
videoBlocker.addEventListener('click', () => {
  if (playerReady) {
    togglePlay();
  }
});

// Handle fullscreen change
document.addEventListener('fullscreenchange', () => {
  fullscreenBtn.textContent = document.fullscreenElement ? 'â›¶' : 'â›¶';
});

// Keyboard shortcuts - IMPORTANT: Now enabled since disablekb=0
document.addEventListener('keydown', (e) => {
  if (!playerReady) return;
  
  switch(e.key) {
    case ' ':
    case 'k':
      e.preventDefault();
      togglePlay();
      break;
    case 'm':
      e.preventDefault();
      toggleMute();
      break;
    case 'f':
      e.preventDefault();
      toggleFullscreen();
      break;
    case 'ArrowLeft':
      e.preventDefault();
      if (player) {
        const currentTime = player.getCurrentTime();
        player.seekTo(Math.max(0, currentTime - 5), true);
      }
      break;
    case 'ArrowRight':
      e.preventDefault();
      if (player) {
        const currentTime = player.getCurrentTime();
        player.seekTo(Math.min(duration, currentTime + 5), true);
      }
      break;
    case 'ArrowUp':
      e.preventDefault();
      if (player) {
        const currentVolume = parseInt(volumeSlider.value);
        const newVolume = Math.min(100, currentVolume + 10);
        volumeSlider.value = newVolume;
        player.setVolume(newVolume);
        updateVolumeFill(newVolume);
        volumeValue.textContent = `${newVolume}%`;
        muteBtn.textContent = newVolume === 0 ? 'ðŸ”‡' : 'ðŸ”Š';
        isMuted = newVolume === 0;
      }
      break;
    case 'ArrowDown':
      e.preventDefault();
      if (player) {
        const currentVolume = parseInt(volumeSlider.value);
        const newVolume = Math.max(0, currentVolume - 10);
        volumeSlider.value = newVolume;
        player.setVolume(newVolume);
        updateVolumeFill(newVolume);
        volumeValue.textContent = `${newVolume}%`;
        muteBtn.textContent = newVolume === 0 ? 'ðŸ”‡' : 'ðŸ”Š';
        isMuted = newVolume === 0;
      }
      break;
  }
});
</script>
</body>
</html>
